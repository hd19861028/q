function isFunction(a){return typeof a==="function"}function isPromiseLike(a){return a&&isFunction(a.then)}function $q(d,g){if(d==undefined||d==null){d=function(k){return k()}}if(g==undefined||g==null){g=function(k){return k}}var a=function(){var m=[],l,k;k={resolve:function(o){if(m){var n=m;m=undefined;l=c(o);if(n.length){d(function(){var r;for(var p=0,q=n.length;p<q;p++){r=n[p];l.then(r[0],r[1],r[2])}})}}},reject:function(n){k.resolve(i(n))},notify:function(n){if(m){var o=m;if(m.length){d(function(){var r;for(var p=0,q=o.length;p<q;p++){r=o[p];r[2](n)}})}}},promise:{then:function(t,p,o){var n=a();var s=function(u){try{n.resolve((isFunction(t)?t:b)(u))}catch(v){n.reject(v);g(v)}};var r=function(v){try{n.resolve((isFunction(p)?p:f)(v))}catch(u){n.reject(u);g(u)}};var q=function(u){try{n.notify((isFunction(o)?o:b)(u))}catch(v){g(v)}};if(m){m.push([s,r,q])}else{l.then(s,r,q)}return n.promise},"catch":function(n){return this.then(null,n)},"finally":function(p){function o(s,r){var q=a();if(r){q.resolve(s)}else{q.reject(s)}return q.promise}function n(r,t){var q=null;try{q=(p||b)()}catch(s){return o(s,false)}if(isPromiseLike(q)){return q.then(function(){return o(r,t)},function(u){return o(u,false)})}else{return o(r,t)}}return this.then(function(q){return n(q,true)},function(q){return n(q,false)})}}};return k};var c=function(k){if(isPromiseLike(k)){return k}return{then:function(m){var l=a();d(function(){l.resolve(m(k))});return l.promise}}};var j=function(l){var k=a();k.reject(l);return k.promise};var i=function(k){return{then:function(n,m){var l=a();d(function(){try{l.resolve((isFunction(m)?m:f)(k))}catch(o){l.reject(o);g(o)}});return l.promise}}};var e=function(q,r,m,p){var s=a(),n;var l=function(t){try{return(isFunction(r)?r:b)(t)}catch(u){g(u);return j(u)}};var o=function(u){try{return(isFunction(m)?m:f)(u)}catch(t){g(t);return j(t)}};var k=function(t){try{return(isFunction(p)?p:b)(t)}catch(u){g(u)}};d(function(){c(q).then(function(t){if(n){return}n=true;s.resolve(c(t).then(l,o,k))},function(t){if(n){return}n=true;s.resolve(o(t))},function(t){if(n){return}s.notify(k(t))})});return s.promise};function b(k){return k}function f(k){return j(k)}function h(n){var l=a(),k=0,m=isArray(n)?[]:{};forEach(n,function(p,o){k++;c(p).then(function(q){if(m.hasOwnProperty(o)){return}m[o]=q;if(!(--k)){l.resolve(m)}},function(q){if(m.hasOwnProperty(o)){return}l.reject(q)})});if(k===0){l.resolve(m)}return l.promise}return{defer:a,reject:j,when:e,all:h}}if(typeof define==="function"&&(define.amd||define.cmd)){define(function(){return $q()})};